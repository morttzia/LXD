<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LXD | بوابة المطورين</title>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0a0a0a;
            --card: #111111;
            --border: rgba(255, 255, 255, 0.05);
            --text-muted: #a1a1aa;
            --danger: #ef4444;
            --primary: #ffffff;
            --success: #10b981;
            --accent: #3b82f6;
        }

        ::-webkit-scrollbar {
            width: 4px;
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #333;
        }
        html {
            scrollbar-width: thin;
            scrollbar-color: rgba(255,255,255,0.05) transparent;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: var(--bg);
            color: #fff;
            margin: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        header {
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
            background: rgba(10, 10, 10, 0.8);
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .logo { font-weight: 800; font-size: 1.5rem; letter-spacing: -1px; }

        .profile-section { position: relative; }
        
        .avatar-trigger {
            width: 40px; height: 40px; background: #27272a; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            border: 1px solid var(--border); cursor: pointer; font-weight: bold;
        }

        .profile-menu {
            position: absolute; top: 55px; left: 0; width: 240px; background: #18181b;
            border: 1px solid var(--border); border-radius: 16px; display: none;
            flex-direction: column; box-shadow: 0 20px 50px rgba(0,0,0,0.5); z-index: 1001;
        }

        .menu-header { padding: 20px; display: flex; align-items: center; gap: 12px; border-bottom: 1px solid var(--border); }
        .menu-avatar { width: 45px; height: 45px; background: #fff; color: #000; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 900; }
        .menu-item { padding: 15px 20px; cursor: pointer; color: var(--text-muted); font-size: 0.9rem; display: flex; align-items: center; gap: 10px; }
        .menu-item:hover { background: rgba(255,255,255,0.03); color: #fff; }

        main { flex: 1; max-width: 900px; margin: 0 auto; width: 100%; padding: 2rem 1rem; }
        .welcome-text { margin-bottom: 2rem; text-align: center; }
        
        .action-row { display: flex; justify-content: center; gap: 10px; margin-bottom: 2rem; }
        
        .btn-main { background: #fff; color: #000; border: none; padding: 12px 24px; border-radius: 12px; font-weight: 700; cursor: pointer; font-size: 0.9rem; transition: 0.2s; }
        .btn-outline { background: transparent; color: #fff; border: 1px solid #fff; }
        .btn-main:hover { transform: translateY(-2px); opacity: 0.9; }

        .table-card { background: var(--card); border: 1px solid var(--border); border-radius: 16px; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 500px; }
        th { text-align: right; padding: 1.2rem; font-size: 0.8rem; color: var(--text-muted); border-bottom: 1px solid var(--border); }
        td { padding: 1.2rem; border-bottom: 1px solid var(--border); font-size: 0.9rem; }
        
        .key-badge { font-family: 'Inter', monospace; color: #fff; background: rgb(255 255 255 / 5%); padding: 4px 10px; border-radius: 6px; border: 1px solid rgb(255 255 255 / 10%); cursor: pointer; }

        .modal-overlay { position: fixed; inset: 0; background: #0000006b; backdrop-filter: blur(8px); z-index: 2000; display: none; align-items: center; justify-content: center; padding: 20px; }
        .modal { padding: 2rem; border-radius: 24px; width: 100%; max-width: 650px; max-height: 90vh; overflow-y: auto; text-align: right; }
        
        .docs-tabs { display: flex; gap: 10px; margin: 20px 0 10px; border-bottom: 1px solid var(--border); padding-bottom: 10px; direction: ltr; }
        .tab { padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 0.8rem; border: 1px solid var(--border); background: #1a1a1ade; color: #888; }
        .tab.active { background: #1a1a1ade; color: #fff; border-color: #fff; }

        .code-box { direction: ltr; text-align: left; font-family: 'Inter', monospace; font-size: 0.7rem; background: #1a1a1ade; padding: 20px; border-radius: 12px; color: #d4d4d4; border: 1px solid var(--border); position: relative; margin-bottom: 20px; line-height: 1.4; }
        .code-keyword { color: #569cd6; }
        .code-string { color: #ce9178; }
        .code-comment { color: #6a9955; font-style: italic; }
        .code-param { color: #9cdcfe; }
        .code-section { color: #dcdcaa; font-weight: bold; border-bottom: 1px solid #333; margin-bottom: 10px; display: block; padding-bottom: 5px; }

        .param-section { margin-top: 25px; border-top: 1px solid var(--border); padding-top: 20px; }
        .param-label { display: block; font-weight: bold; font-size: 0.85rem; color: var(--text-muted); margin-bottom: 8px; }
        
        .model-selector {
            width: 100%; background: #1a1a1ade; border: 1px solid var(--border); color: #fff;
            padding: 14px; border-radius: 12px; font-family: 'Inter', monospace;
            display: flex; justify-content: space-between; align-items: center; cursor: pointer;
            transition: 0.3s; margin-bottom: 15px;
        }
        .model-selector:hover { border-color: #444; background: #050505; }
        .model-dropdown {
            background: #18181b; border: 1px solid var(--border); border-radius: 12px;
            margin-top: -10px; margin-bottom: 15px; display: none; flex-direction: column; overflow: hidden;
        }
        .model-option { padding: 12px 16px; font-size: 0.85rem; cursor: pointer; transition: 0.2s; display: flex; align-items: center; gap: 10px; }
        .model-option:hover { background: rgba(255,255,255,0.03); }
        .model-option.active { color: var(--success); font-weight: bold; }

        .auth-screen { position: fixed; inset: 0; background: #000; z-index: 5000; display: flex; align-items: center; justify-content: center; }
        .auth-box { padding: 2.5rem; border-radius: 24px; width: 100%; max-width: 380px; border: 1px solid var(--border); text-align: center; }
        .auth-box input { width: 100%; padding: 14px; margin: 10px 0; background: #1a1a1ade; border: 1px solid var(--border); color: #fff; border-radius: 12px; outline: none; }

        .hidden { display: none !important; }
    </style>
</head>
<body>

<div id="auth-layer" class="auth-screen">
    <div class="auth-box">
        <h1 style="margin-bottom: 2rem;">LXD API</h1>
        <input type="email" id="email" placeholder="البريد الإلكتروني">
        <input type="password" id="password" placeholder="كلمة المرور">
        <button class="btn-main" style="width: 100%; justify-content: center;" onclick="handleAuth()">دخول النظام</button>
    </div>
</div>

<header class="hidden" id="app-header">
    <div class="logo">LXD</div>
    <div class="profile-section">
        <div class="avatar-trigger" id="avatar-btn">U</div>
        <div class="profile-menu" id="dropdown-menu">
            <div class="menu-header">
                <div class="menu-avatar" id="menu-avatar-char">U</div>
                <div style="display:flex; flex-direction:column; text-align:right;">
                    <span id="display-name" style="font-weight:bold; font-size:0.9rem;">المستخدم</span>
                    <span id="display-level" style="font-size:0.7rem; color:var(--text-muted)">lv. 1</span>
                </div>
            </div>
            <div class="menu-item" onclick="signOut()" style="color: var(--danger)">تسجيل الخروج</div>
        </div>
    </div>
</header>

<main class="hidden" id="app-main">
    <div class="welcome-text">
        <h1>لوحة تحكم المطورين</h1>
        <p>إدارة مفاتيح API والوصول المتقدم للنماذج.</p>
    </div>

    <div class="action-row">
        <button class="btn-main" onclick="openModal('create-modal')">إنشاء مفتاح جديد</button>
        <button class="btn-main btn-outline" onclick="openModal('docs-modal')">دليل الاستدعاء</button>
    </div>

    <div class="table-card">
        <table>
            <thead><tr><th>الاسم</th><th>الاستخدام</th><th>المفتاح</th><th>تحكم</th></tr></thead>
            <tbody id="keys-body"></tbody>
        </table>
    </div>
</main>

<div id="docs-modal" class="modal-overlay" onclick="if(event.target===this) closeModal('docs-modal')">
    <div class="modal">
        <h2 style="margin-bottom:10px;">دليل المطورين</h2>        
        <div class="docs-tabs">
            <div class="tab active" onclick="switchTab('curl')">cURL</div>
            <div class="tab" onclick="switchTab('js')">JavaScript</div>
            <div class="tab" onclick="switchTab('py')">Python</div>
        </div>

        <div id="code-curl" class="code-box">
            <span class="code-keyword">curl</span> -X POST https://lxds.vercel.app/api \<br>
            &nbsp;&nbsp;-H <span class="code-string">"Authorization: Bearer YOUR_KEY"</span> \<br>
            &nbsp;&nbsp;-H <span class="code-string">"Content-Type: application/json"</span> \<br>
            &nbsp;&nbsp;-d '{<br>
            &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-param">"prompt"</span>: <span class="code-string">"Hello world"</span>,<br>
            &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-param">"model"</span>: <span class="code-string">"gpt-oss-120b"</span><br>
            &nbsp;&nbsp;}'<br><br>
            <span class="code-param">{</span><br>
            &nbsp;&nbsp;<span class="code-param">"success"</span>: <span class="code-keyword">true</span>,<br>
            &nbsp;&nbsp;<span class="code-param">"result"</span>: <span class="code-string">"نص الإجابة الصافي هنا..."</span><br>
            <span class="code-param">}</span>
        </div>

        <div id="code-js" class="code-box hidden">
            <span class="code-keyword">const</span> response = <span class="code-keyword">await</span> fetch(<span class="code-string">'https://lxds.vercel.app/api'</span>, {<br>
            &nbsp;&nbsp;method: <span class="code-string">'POST'</span>,<br>
            &nbsp;&nbsp;headers: {<br>
            &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-string">'Authorization'</span>: <span class="code-string">'Bearer YOUR_KEY'</span>,<br>
            &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-string">'Content-Type'</span>: <span class="code-string">'application/json'</span><br>
            &nbsp;&nbsp;},<br>
            &nbsp;&nbsp;body: JSON.stringify({<br>
            &nbsp;&nbsp;&nbsp;&nbsp;prompt: <span class="code-string">"سؤالك هنا"</span>,<br>
            &nbsp;&nbsp;&nbsp;&nbsp;model: <span class="code-string">"gpt-oss-120b"</span><br>
            &nbsp;&nbsp;})<br>
            });<br><br>
            <span class="code-keyword">const</span> data = <span class="code-keyword">await</span> response.json();<br>
            <span class="code-keyword">if</span> (data.success)
        </div>

        <div id="code-py" class="code-box hidden">
            <span class="code-keyword">import</span> requests<br><br>
            url = <span class="code-string">"https://lxds.vercel.app/api"</span><br>
            headers = {<br>
            &nbsp;&nbsp;<span class="code-string">"Authorization"</span>: <span class="code-string">"Bearer YOUR_KEY"</span>,<br>
            &nbsp;&nbsp;<span class="code-string">"Content-Type"</span>: <span class="code-string">"application/json"</span><br>
            }<br>
            data = {<br>
            &nbsp;&nbsp;<span class="code-string">"prompt"</span>: <span class="code-string">"كيف حالك؟"</span>,<br>
            &nbsp;&nbsp;<span class="code-string">"model"</span>: <span class="code-string">"gpt-oss-120b"</span><br>
            }<br><br>
            response = requests.post(url, headers=headers, json=data)<br><br>
            <span class="code-keyword">if</span> response.status_code == <span class="code-string">200</span>:<br>
            &nbsp;&nbsp;result_json = response.json()<br>
            &nbsp;&nbsp;<span class="code-keyword">if</span> result_json.get(<span class="code-string">'success'</span>):<br>
            &nbsp;&nbsp;&nbsp;&nbsp;print(result_json[<span class="code-string">'result'</span>])<br>
            &nbsp;&nbsp;<span class="code-keyword">else</span>:<br>
            &nbsp;&nbsp;&nbsp;&nbsp;print(<span class="code-string">"Error:"</span>, result_json.get(<span class="code-string">'error'</span>))
        </div>

        <div class="param-section">
            <span class="param-label">النماذج:</span>
            <div class="model-selector" onclick="toggleModelDropdown()">
                <span id="selected-model-text">gpt-oss-120b</span>
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
            </div>
            <div class="model-dropdown" id="model-list">
                <div class="model-option active">
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
                    gpt-oss-120b
                </div>
            </div>
        </div>
    </div>
</div>

<div id="create-modal" class="modal-overlay" onclick="if(event.target===this) closeModal('create-modal')">
    <div class="modal" style="max-width: 400px;">
        <h3>توليد مفتاح وصول</h3>
        <input type="text" id="new-key-name" placeholder="اسم المفتاح (مثلاً: تطبيق أندرويد)..." style="width:100%; padding:14px; margin:20px 0; background:#000; border:1px solid var(--border); color:#fff; border-radius:12px; outline:none;">
        <div style="display:flex; gap:10px;">
            <button class="btn-main" style="flex:2;" onclick="confirmCreateKey()">إنشاء</button>
            <button class="btn-main btn-outline" style="flex:1;" onclick="closeModal('create-modal')">إلغاء</button>
        </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut as fSignOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, doc, getDoc, collection, query, where, onSnapshot, addDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAcYVpRogd4yNKnN-_2uMIftcw3KpWYAZI",
        authDomain: "minivision-lxd.firebaseapp.com",
        projectId: "minivision-lxd",
        appId: "1:587275838193:web:5220dc6362241f0ef83f50"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const avatarBtn = document.getElementById('avatar-btn');
    const dropdownMenu = document.getElementById('dropdown-menu');
    avatarBtn.onclick = (e) => { e.stopPropagation(); dropdownMenu.style.display = dropdownMenu.style.display === 'flex' ? 'none' : 'flex'; };
    window.onclick = () => { dropdownMenu.style.display = 'none'; document.getElementById('model-list').style.display = 'none'; };

    window.openModal = (id) => document.getElementById(id).style.display = 'flex';
    window.closeModal = (id) => document.getElementById(id).style.display = 'none';

    window.toggleModelDropdown = (e) => {
        if(e) e.stopPropagation();
        const list = document.getElementById('model-list');
        list.style.display = list.style.display === 'flex' ? 'none' : 'flex';
    };

    window.switchTab = (lang) => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.code-box').forEach(b => b.classList.add('hidden'));
        event.target.classList.add('active');
        document.getElementById(`code-${lang}`).classList.remove('hidden');
    };

    onAuthStateChanged(auth, async (user) => {
        if (user) {
            document.getElementById('auth-layer').classList.add('hidden');
            document.getElementById('app-header').classList.remove('hidden');
            document.getElementById('app-main').classList.remove('hidden');
            const uDoc = await getDoc(doc(db, "users", user.uid));
            if (uDoc.exists()) {
                const d = uDoc.data();
                document.getElementById('display-name').innerText = d.displayName || user.email.split('@')[0];
                document.getElementById('display-level').innerText = "lv. " + (d.level || 1);
                document.getElementById('avatar-btn').innerText = (d.displayName || 'U')[0].toUpperCase();
            }
            loadKeys(user.uid);
        } else {
            document.getElementById('auth-layer').classList.remove('hidden');
        }
    });

    function loadKeys(uid) {
        const q = query(collection(db, "api_keys"), where("owner", "==", uid));
        onSnapshot(q, (snaps) => {
            const body = document.getElementById('keys-body');
            body.innerHTML = '';
            snaps.forEach(d => {
                const data = d.data();
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td style="font-weight:600">${data.name}</td>
                    <td style="color:var(--text-muted)">${data.calls || 0} طلب</td>
                    <td><span class="key-badge" onclick="copyKey('${data.key}')">${data.key}</span></td>
                    <td><button class="delete-btn" onclick="deleteKey('${d.id}')" style="background:none; border:none; color:#555; cursor:pointer;">
                        <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                    </button></td>
                `;
                body.appendChild(tr);
            });
        });
    }

    window.confirmCreateKey = async () => {
        const name = document.getElementById('new-key-name').value.trim();
        if(!name) return;
        const key = 'lxd_' + Math.random().toString(36).substr(2, 16);
        await addDoc(collection(db, "api_keys"), { name, key, owner: auth.currentUser.uid, calls: 0, createdAt: new Date() });
        closeModal('create-modal');
        document.getElementById('new-key-name').value = '';
    };

    window.deleteKey = async (id) => { if(confirm("هل تريد حذف هذا المفتاح؟")) await deleteDoc(doc(db, "api_keys", id)); };
    window.copyKey = (k) => { navigator.clipboard.writeText(k); alert("تم نسخ المفتاح!"); };
    window.handleAuth = async () => {
        const e = document.getElementById('email').value;
        const p = document.getElementById('password').value;
        try { await signInWithEmailAndPassword(auth, e, p); } catch { await createUserWithEmailAndPassword(auth, e, p); }
    };
    window.signOut = () => fSignOut(auth);
</script>
</body>
</html>
